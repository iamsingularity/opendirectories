// Generated by CoffeeScript 1.9.3
(function() {
  var Google, app;

  app = angular.module("opendirectories.controllers", []);

  Google = (function() {
    function Google(model) {
      this.model = model;
      this.server = "https://www.google.com/";
      this.path = "search";
      return;
    }

    Google.prototype.buildUrl = function() {
      return "" + this.server + this.path + "?q=" + (encodeURIComponent(this.buildQuery()));
    };

    Google.prototype.buildQuery = function() {
      var blacklistItem, i, len, queryString, ref;
      queryString = "";
      queryString = this.model.alternative ? "\"parent directory\" " : "intitle:\"index.of\" ";
      queryString += this.model.quoted ? " \"" + this.model.query + "\" " : this.model.query;
      queryString += " -html -htm -php -asp -jsp ";
      ref = this.model.blacklist;
      for (i = 0, len = ref.length; i < len; i++) {
        blacklistItem = ref[i];
        queryString += " -" + blacklistItem;
      }
      return "" + queryString + (this.buildExt());
    };

    Google.prototype.buildExt = function() {
      var queryType;
      queryType = this.model.queryTypes[this.model.queryType];
      if (queryType.exts === "") {
        return "";
      } else {
        return " (" + (queryType.exts.split(',').join("|")) + ") ";
      }
    };

    return Google;

  })();

  app.controller("appController", [
    "$scope", "$mdMedia", "$mdSidenav", "DEFAULT_BLACKLIST", "DEFAULT_QUERY_TYPES", function($scope, $mdMedia, $mdSidenav, DEFAULT_BLACKLIST, DEFAULT_QUERY_TYPES) {
      var loadFromChrome;
      $scope.model = {
        query: null,
        queryTypes: DEFAULT_QUERY_TYPES,
        queryType: 0,
        alternative: false,
        quoted: true,
        incognito: true,
        blacklist: DEFAULT_BLACKLIST
      };
      loadFromChrome = function() {
        chrome.storage.sync.get("blacklist", function(data) {
          if (data.blacklist) {
            return $scope.model.blacklist = JSON.parse(data.blacklist);
          }
        });
        return chrome.storage.sync.get("queryTypes", function(data) {
          if (data.queryTypes) {
            return $scope.model.queryTypes = JSON.parse(data.queryTypes);
          }
        });
      };
      loadFromChrome();
      $scope.$on("reload.chrome", function() {
        return loadFromChrome();
      });
      $scope.buildQuery = function() {
        return new Google($scope.model).buildQuery();
      };
      $scope.search = function() {
        if ($scope.model.query) {
          return chrome.windows.create({
            url: new Google($scope.model).buildUrl(),
            incognito: $scope.model.incognito
          });
        }
      };
      return $scope.showMenu = function() {
        return $mdSidenav('right').toggle();
      };
    }
  ]);

}).call(this);
