// Generated by CoffeeScript 1.9.3
(function() {
  var app;

  app = angular.module("downloader.downloads.controllers", []);

  app.controller("NewDownloadController", [
    "$scope", "$rootScope", "$mdDialog", "$http", "Server", function($scope, $rootScope, $mdDialog, $http, Server) {
      $scope.model = {
        url: "",
        http_username: "",
        http_password: "",
        file_filter: ""
      };
      $scope.forms = {};
      $scope.error = null;
      $scope.save = function() {
        var failure, success;
        success = function() {
          $rootScope.$broadcast("downloads.get");
          return $mdDialog.hide();
        };
        failure = function(message) {
          return $scope.error = message;
        };
        return Server.service.create($scope.model).then(success, failure);
      };
      return $scope.close = function() {
        return $mdDialog.hide();
      };
    }
  ]);

  app.controller("DownloadsController", [
    "$scope", "$rootScope", "$mdDialog", "Server", function($scope, $rootScope, $mdDialog, Server) {
      $scope.downloads = [];
      $rootScope.$on("downloads.get", function() {
        return $scope.getDownloads();
      });
      $scope.getDownloads = function() {
        return Server.service.get("/api/v1/downloads.json").then(function(data) {
          return $scope.downloads = data;
        });
      };
      $scope.newDownload = function($event) {
        return $mdDialog.show({
          templateUrl: "downloads/new.html",
          controller: "NewDownloadController",
          clickOutsideToClose: false
        }).then(function() {
          return $scope.getDownloads();
        });
      };
      $scope.deleteDownload = function(download, $event) {
        var confirm;
        confirm = $mdDialog.confirm().title("Delete Download").content("Are you sure you want to delete '" + download.url + "'?").ok("BE GONE WITH IT!").cancel("No").targetEvent($event);
        return $mdDialog.show(confirm).then((function() {
          return Server.service["delete"](download).then(function() {
            return $scope.getDownloads();
          });
        }));
      };
      $scope.cancelDownload = function(download) {
        return Server.service.cancel(download).then(function() {
          return $scope.getDownloads();
        });
      };
      $scope.queueDownload = function(download) {
        return Server.service.queue(download).then(function() {
          return $scope.getDownloads();
        });
      };
      return $scope.clearDownloads = function() {
        return Server.service.clear().then(function() {
          return $scope.getDownloads();
        });
      };
    }
  ]);

}).call(this);
